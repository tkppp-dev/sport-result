# 스포츠 결과 확인하기 웹

**목적**: 내가 좋아하는 스포츠에 대해 경기 결과 및 기록을 빠르고 쉽게 확인하기 위해

**URL**  
- KBO Page: http://tkppp-server.tk
- LCK Page: http://tkppp-server.tk/lck
cf) 해외 도메인이라 특정 통신사에서는 접속이 안될 수 있음. 그럴 경우 13.209.36.27:8080 로 접속

# 구현 범위
1. KBO - 완료
2. LCK - 완료
3. NBA

현재 관심있는 스포츠 3가지에 대해 구현 예정

# 각 카테고리에서 확인할 수 있는 내용
1. 가장 최근 경기 결과 및 기록
2. 순위
3. 일정 및 결과

# 사용 기술 
**Backend** - Typescript, Express, Typeorm, Cheerio, puppeteer  
**Frontend** - Vue.js   
**DevOps** - AWS EC2, RDS

## 마이그레이션 전 사용 기술
**마이그레이션 전 소스** : regacy 브랜치  
**Backend(Main Server)** - Kotlin, SpringBoot, JPA, MySQL   
**Backend(Crawling Server)** - Node.js, Express, Cheerio, puppeteer  

# 서버 마이그레이션
## 마이그레이션 결정 이유
- LCK 관련 서비스 업데이트 후 EC2 서버가 지속적으로 다운되는 현상이 발생했지만 원인을 찾지 못해 낮은 성능의 EC2 서버가 버티지 못하는 것으로 추정. 실제로 애플리케이션 실행 시 메모리 스왑 없이는 돌아가지 않는 상황
- AWS 프리티어가 끝나는 7월 이후 `AWS Ligthsail` 과 같은 가상 서버로 이전할 계획을 가지고 있어 DB도 함께 서버에서 사용해야되는 상황이기 때문에 무거운 SpringBoot 기반 메인 서버와 Express 기반 크롤링 서버에 DB 까지 하나의 인스턴스에 올려야하는 상황이기에 모든 기능을 Express 기반으로 마이그레이션 하기로 결정하고 프로젝트 진행

## 마이그레이션 결과 및 장애 원인
- EC2 서버의 성능은 1 Core, 1GB Memory 의 t2.micro
- 애플리케이션 실행시 메모리 부족으로 인해 메모리 스왑없이 돌아가지 않았던 기존 프로젝트와 달리 기능 통합 및 마이그레이션을 완료한 현재 프로젝트는 메모리 스왑 없이 약350MB 가량의 메모리 여유 공간을 가짐
- 마이그레이션 완료후 메모리는 여유가 생겼지만 여전히 서버가 다운되는 현상 발생. 메모리 사용 상황을 보니 애플리케이션 실행 초기보다 더 많은 메모리를 사용하는 것이 확인. 하여 메모리 사용 프로세스 확인 해보니 여러개의 크롬 프로세스가 메모리를 점유하는 것을 확인
- 결국 장애 원인은 `puppeteer` 를 사용해 크롤링 후 크롬 브라우저의 메모리를 해제하지 않아 메모리 누수 발생했기 때문으로 확인. 결국 크롤링 후 브라우저 메모리 해제 메소드를 호출 하는 것으로  문제 해결

# 구현
## 국내야구
- 당일 경기 상태
- 순위
- 일정: 네이버 KBO 일정 페이지로 리다이렉트

## LCK
구현 완료  
- 당일 경기 결과
- 주간 경기 일정

# 추후 목표
- Travis CI를 활용한 배포 자동화를 구현해 다른 기능 구현시 배포 편의성 증대
- NBA는 시즌 마무리가 얼마 남지 않아 구현 필요성을 느끼기 어려워 잠정 중단

